<?xml version="1.0" encoding="UTF-8"?>
<testcase xmlns="http://xlt.xceptance.com/xlt-script/2" version="6" junit-test="true">
  <tags>smoke</tags>
  <description>Test select, remove and clear color refinement on catalog page.

# 1. Setup and preparation

- Start session, open homepage and delete all visible cookies

# 2. Scope of test

- Browse to category
- Select, validate and remove color via name
- Select three colors via position
- Remove one color via breadcrumb
- Remove two colors clear
- Validate empty color list
- Validate empty refinement list in breadcrumbs

# 3. Clean up

- End session and clean up created cookies
</description>
  <codecomment># Setup

- Start session</codecomment>
  <module name="modules.helper.FHelper_Session_flowToStartSession"/>
  <codecomment># Scope</codecomment>
  <codecomment>## Catalog

- Go to catalog page
- Validate page</codecomment>
  <action name="GoToCategoryPage"/>
  <module name="modules.global.headerfooternav.MGlobal_Nav_clickGoToCategoryLevel3">
    <parameter name="positionLevel1" value="2"/>
    <parameter name="positionLevel2" value="1"/>
    <parameter name="positionLevel3" value="2"/>
  </module>
  <module name="modules.pages.catalog.VCatalog_validatePage"/>
  <codecomment>## Catalog

- Select color by clicking
- Valdiate color selected
- Unselect color by clicking again
- Validate color unselected</codecomment>
  <action name="RefinePriceByTitle"/>
  <module name="modules.pages.catalog.MCatalog_Refinement_clickPriceByTitle">
    <parameter name="title" value="${priceRange01}"/>
  </module>
  <action name="SortProductsPriceLowToHigh"/>
  <module name="modules.pages.catalog.MCatalog_Option_selectSortByByLabel">
    <parameter name="sortByLabel" value="Price Low To High"/>
  </module>
  <codecomment>----------</codecomment>
  <module name="modules.pages.catalog.SCatatlog_storeProductPriceFromProduct">
    <parameter name="position" value=":first-of-type"/>
    <parameter name="productPrice_varName" value="productPrice_varDynamic"/>
  </module>
  <module name="modules.helper.MHelper_Price_convertPriceToValue">
    <parameter name="price" value="${productPrice_varDynamic}"/>
    <parameter name="priceValue_varName" value="priceValue_varDynamic"/>
    <parameter name="priceCurrency" value="${storefront_priceCurrency}"/>
    <parameter name="priceDecimalMark" value="${storefront_priceDecimalMark}"/>
    <parameter name="priceDigitGroupSeparators" value="${storefront_priceDigitGroupSeparators}"/>
  </module>
  <module name="modules.pages.catalog.VCatalog_Refinments_validatePriceRange">
    <parameter name="lowerBorder" value="${priceRange00}"/>
    <parameter name="upperBorder" value="${priceRange01}"/>
    <parameter name="priceValue" value="${priceValue_varDynamic}"/>
  </module>
  <codecomment>----------</codecomment>
  <module name="modules.pages.catalog.SCatatlog_storeProductPriceFromProduct">
    <parameter name="position" value=":last-of-type"/>
    <parameter name="productPrice_varName" value="productPrice_varDynamic"/>
  </module>
  <module name="modules.helper.MHelper_Price_convertPriceToValue">
    <parameter name="price" value="${productPrice_varDynamic}"/>
    <parameter name="priceValue_varName" value="priceValue_varDynamic"/>
    <parameter name="priceCurrency" value="${storefront_priceCurrency}"/>
    <parameter name="priceDecimalMark" value="${storefront_priceDecimalMark}"/>
    <parameter name="priceDigitGroupSeparators" value="${storefront_priceDigitGroupSeparators}"/>
  </module>
  <module name="modules.pages.catalog.VCatalog_Refinments_validatePriceRange">
    <parameter name="lowerBorder" value="${priceRange00}"/>
    <parameter name="upperBorder" value="${priceRange01}"/>
    <parameter name="priceValue" value="${priceValue_varDynamic}"/>
  </module>
  <action name="RemovePrice"/>
  <module name="modules.pages.catalog.MCatalog_Refinements_removeSelectedPrice"/>
  <codecomment>## Catalog

- Select the other three price options
- validate shown prices and braedcrumb</codecomment>
  <action name="RefinePriceByTitle"/>
  <module name="modules.pages.catalog.MCatalog_Refinement_clickPriceByTitle">
    <parameter name="title" value="${priceRange02}"/>
  </module>
  <codecomment>----------</codecomment>
  <module name="modules.pages.catalog.SCatalog_Refinements_storeFirstProductPrice">
    <parameter name="productPrice_varName" value="productPrice_varDynamic"/>
  </module>
  <module name="modules.helper.MHelper_Price_convertPriceToValue">
    <parameter name="price" value="${productPrice_varDynamic}"/>
    <parameter name="priceValue_varName" value="priceValue_varDynamic"/>
    <parameter name="priceCurrency" value="${storefront_priceCurrency}"/>
    <parameter name="priceDecimalMark" value="${storefront_priceDecimalMark}"/>
    <parameter name="priceDigitGroupSeparators" value="${storefront_priceDigitGroupSeparators}"/>
  </module>
  <module name="modules.pages.catalog.VCatalog_Refinments_validatePriceRange">
    <parameter name="lowerBorder" value="${priceRange01}"/>
    <parameter name="upperBorder" value="${priceRange02}"/>
    <parameter name="priceValue" value="${priceValue_varDynamic}"/>
  </module>
  <codecomment>----------</codecomment>
  <module name="modules.pages.catalog.VCatalog_Refinement_validatePriceInBreadcrumb">
    <parameter name="title" value="${priceRange02}"/>
  </module>
  <action name="RefineColorByPostion"/>
  <module name="modules.pages.catalog.MCatalog_Refinement_clickPriceByTitle">
    <parameter name="title" value="${priceRange03}"/>
  </module>
  <module name="modules.pages.catalog.VCatalog_Refinement_validatePriceInBreadcrumb">
    <parameter name="title" value="${priceRange03}"/>
  </module>
  <action name="RefineColorByPostion"/>
  <module name="modules.pages.catalog.MCatalog_Refinement_clickPriceByTitle">
    <parameter name="title" value="${priceRange04}"/>
  </module>
  <module name="modules.pages.catalog.VCatalog_Refinement_validatePriceInBreadcrumb">
    <parameter name="title" value="${priceRange04}"/>
  </module>
  <codecomment>## Catalog

- Remove filter by breadcrumb position
- Validate color is unselected
- Clear all color list
- Validate color list is empty
- Validate refinement list is empty</codecomment>
  <action name="RemoveFilter"/>
  <module name="modules.pages.catalog.MCatalog_Refinements_removeSelectedPrice"/>
  <action name="ClearColors"/>
  <module name="modules.pages.catalog.MCatalog_Refinement_clickPriceByTitle">
    <parameter name="title" value="${priceRange04}"/>
  </module>
  <command name="click" target="css=#secondary.refinements div.refinement  .clear-refinement a"/>
  <command name="waitForNotClass" target="css=#secondary.refinements div:nth-of-type(5) ul li " value="selected"/>
</testcase>
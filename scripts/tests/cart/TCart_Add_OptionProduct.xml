<?xml version="1.0" encoding="UTF-8"?>
<testcase xmlns="http://xlt.xceptance.com/xlt-script/2" version="6">
  <tags>cart,add,options</tags>
  <description>Add an option product to the cart.

# Setup

- Start session, open homepage and delete all visible cookies.

# Scope

- search product
- sort to ensure consitency
- open quckview, select option, add to cart

- verify cart

- remove product again

- repeat with add to cart from product detail page</description>
  <codecomment># Setup

- Start Session</codecomment>
  <module name="modules.helper.FHelper_Session_flowToStartSession"/>
  <action name="SearchProducts"/>
  <module name="modules.pages.search.MSearch_enterTextAndSubmit">
    <parameter name="searchText" value="${searchPhrase}"/>
  </module>
  <action name="SortByName"/>
  <codecomment>Sort products to ensure, that the needed product is on the catalog page</codecomment>
  <module name="modules.pages.catalog.MCatalog_Option_selectSortByByLabel">
    <parameter name="sortByLabel" value="Product Name A - Z"/>
  </module>
  <action name="GoToQuickView"/>
  <module name="modules.pages.catalog.MCatalog_clickQuickViewByProductPosition">
    <parameter name="position" value="2"/>
  </module>
  <codecomment># Scope</codecomment>
  <module name="modules.pages.product.MProduct_selectOptionByLabel">
    <parameter name="selectedLabel" value="[$9.99] 1 Year Warranty"/>
  </module>
  <module name="modules.pages.product.MProduct_storeAddToCartPrice">
    <parameter name="addToCartPrice_var" value="productPriceSubTotal"/>
  </module>
  <module name="modules.pages.product.MProduct_storeBasicData">
    <parameter name="productName_varName" value="productName"/>
    <parameter name="productNumber_varName" value="productNumber"/>
    <parameter name="productPriceSales_varName" value="productPrice"/>
  </module>
  <action name="AddToCart"/>
  <module name="modules.pages.product.MProduct_clickAddToCart"/>
  <codecomment>After clicking the Add to Cart button, the QC becomes invisible</codecomment>
  <command name="waitForNotVisible" target="id=pdpMain"/>
  <action name="ViewCart"/>
  <module name="modules.global.minicart.MGlobal_MiniCart_clickGoToCartByHeaderLink"/>
  <module name="modules.pages.cart.VCart_Row_validateProductBasicDetails">
    <parameter name="row" value="1"/>
    <parameter name="productName" value="${productName}"/>
    <parameter name="productNumber" value="${productNumber}"/>
    <parameter name="productQuantity" value="1"/>
    <parameter name="productPriceSales" value="${productPrice}"/>
  </module>
  <module name="modules.pages.cart.VCart_validatePageTotalsSubtotal">
    <parameter name="totalsSubtotal" value="${productPriceSubTotal}"/>
  </module>
  <module name="modules.pages.cart.VCart_validatePage"/>
  <action name="RemoveProduct"/>
  <module name="modules.pages.cart.MCart_Row_clickRemoveProduct">
    <parameter name="row" value="1"/>
  </module>
  <module name="modules.pages.cart.VCart_validateCartIsEmpty"/>
  <action name="SearchProductBySKU"/>
  <module name="modules.pages.search.MSearch_enterTextAndSubmit">
    <parameter name="searchText" value="${productNumber}"/>
  </module>
  <action name="AddToCart"/>
  <module name="modules.pages.product.MProduct_selectOptionByLabel">
    <parameter name="selectedLabel" value="[$9.99] 1 Year Warranty"/>
  </module>
  <module name="modules.pages.product.MProduct_clickAddToCart"/>
  <action name="ViewCart"/>
  <module name="modules.global.minicart.MGlobal_MiniCart_clickGoToCartByHeaderLink"/>
  <module name="modules.pages.cart.VCart_Row_validateProductBasicDetails">
    <parameter name="row" value="1"/>
    <parameter name="productName" value="${productName}"/>
    <parameter name="productNumber" value="${productNumber}"/>
    <parameter name="productQuantity" value="1"/>
    <parameter name="productPriceSales" value="${productPrice}"/>
  </module>
  <module name="modules.pages.cart.VCart_validatePageTotalsSubtotal">
    <parameter name="totalsSubtotal" value="${productPriceSubTotal}"/>
  </module>
  <module name="modules.pages.cart.VCart_validatePage"/>
</testcase>
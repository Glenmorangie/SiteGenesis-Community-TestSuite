<?xml version="1.0" encoding="UTF-8"?>
<testcase xmlns="http://xlt.xceptance.com/xlt-script/2" version="6" junit-test="true">
  <tags>smoke</tags>
  <description>Test refresh products and calculate sums with update quantity and resort rows in cart. This test needs a full desktop view of the browser, otherwise the minicart won't display the total and the test will fail.

# 1. Setup and preparation

- Start session, open homepage and delete all visible cookies.

# 2. Scope of test

## Product 01 - Change quantity via update cart

- Add product 01 to cart (quantity 1).
- Validate product and subtotal.
- Increase quantity to random value via update cart function.
- Calculate formatted total product price based on updated quantity.
- Validate product price and subtotal.

## Product 02 - Change quantity via edit dialog

- Add product 02 to cart (quantity 2).
- Calculate formatted total product price.
- Calculate subtotal and number of items for both products.
- Validate both products and subtotal.
- Increase product 02 quantity to random value via edit details dialog.
- Calculate new subtotal and number of items for both products.
- Validate calculated values in mini cart header.
- Validate both products and subtotal on cart page.

## Product 01 and 02 - Remove and rearrange rows

- Remove product 01.
- Validate product 02 is still in cart.
- Validate subtotal.
- Remove product 02.
- Validate emty cart.

# 3. Clean up

- End session and clean up created cookies.</description>
  <codecomment># Setup

- Start Session</codecomment>
  <module name="modules.helper.FHelper_Session_flowToStartSession"/>
  <codecomment>## Add product 01 to cart</codecomment>
  <module name="modules.pages.search.FSearch_flowToAddProductToCart">
    <comment>Add the first product with quantity 1 to the cart. The output value of productPriceTotal is "unused" because it will be calculated in the test and validated against the storefront presentation.</comment>
    <parameter name="cartRow" value="1"/>
    <parameter name="productNumber" value="${productNumber_01}"/>
    <parameter name="productQuantity" value="${productQuantity_01}"/>
    <parameter name="productName_varName" value="productName_01_varDynamic"/>
    <parameter name="productNumber_varName" value="productNumber_01_varDynamic"/>
    <parameter name="productQuantity_varName" value="productQuantity_01_varDynamic"/>
    <parameter name="productPriceSales_varName" value="productPriceSales_01_varDynamic"/>
    <parameter name="productPriceTotal_varName" value="unused"/>
  </module>
  <codecomment>## Add product 02 to cart</codecomment>
  <module name="modules.pages.search.FSearch_flowToAddProductToCart">
    <comment>Add the second product with quantity 2 to the cart. The output value of productPriceTotal is "unused" because it will be calculated in the test and validated against the storefront presentation.</comment>
    <parameter name="cartRow" value="2"/>
    <parameter name="productNumber" value="${productNumber_02}"/>
    <parameter name="productQuantity" value="${productQuantity_02}"/>
    <parameter name="productName_varName" value="productName_02_varDynamic"/>
    <parameter name="productNumber_varName" value="productNumber_02_varDynamic"/>
    <parameter name="productQuantity_varName" value="productQuantity_02_varDynamic"/>
    <parameter name="productPriceSales_varName" value="productPriceSales_02_varDynamic"/>
    <parameter name="productPriceTotal_varName" value="productPriceTotal_02_varDynamic"/>
  </module>
  <codecomment>## Helper

- Calculate product price total 02
- Calculate product totals quantity
- Calculate product totals subtotal</codecomment>
  <module name="modules.pages.cart.VCart_Row_validateProductBasicDetails">
    <parameter name="row" value="2"/>
    <parameter name="productName" value="${productName_02_varDynamic}"/>
    <parameter name="productNumber" value="${productNumber_02_varDynamic}"/>
    <parameter name="productQuantity" value="${productQuantity_02_varDynamic}"/>
    <parameter name="productPriceSales" value="${productPriceSales_02_varDynamic}"/>
  </module>
  <module name="modules.pages.cart.VCart_Row_validateProductPriceTotal">
    <parameter name="row" value="2"/>
    <parameter name="productPriceTotal" value="${productPriceTotal_02_varDynamic}"/>
  </module>
  <codecomment># Scope</codecomment>
  <codecomment>------------------------------------------------------------</codecomment>
  <codecomment>## Product 01 and 02 - Remove first item</codecomment>
  <codecomment>------------------------------------------------------------</codecomment>
  <codecomment>### Cart

- Remove first item
- Validate mini cart header items updated
- Validate second item is still in cart
- Validate totals subtotal is updated</codecomment>
  <action name="RemoveProduct"/>
  <module name="modules.pages.cart.MCart_Row_clickRemoveProduct">
    <parameter name="row" value="1"/>
  </module>
  <module name="modules.global.minicart.VGlobal_MiniCart_validateHeaderTotals">
    <parameter name="totalsQuantity" value="${productQuantity_02}"/>
    <parameter name="totalsSubtotal" value="${productPriceTotal_02_varDynamic}"/>
  </module>
  <module name="modules.pages.cart.VCart_Row_validateProductBasicDetails">
    <parameter name="row" value="1"/>
    <parameter name="productName" value="${productName_02_varDynamic}"/>
    <parameter name="productNumber" value="${productNumber_02_varDynamic}"/>
    <parameter name="productQuantity" value="${productQuantity_02_varDynamic}"/>
    <parameter name="productPriceSales" value="${productPriceSales_02_varDynamic}"/>
  </module>
  <module name="modules.pages.cart.VCart_Row_validateProductPriceTotal">
    <parameter name="row" value="1"/>
    <parameter name="productPriceTotal" value="${productPriceTotal_02_varDynamic}"/>
  </module>
  <module name="modules.pages.cart.VCart_validatePageTotalsSubtotal">
    <parameter name="totalsSubtotal" value="${productPriceTotal_02_varDynamic}"/>
  </module>
  <codecomment>### Cart

- Remove second product
- Validate empty cart</codecomment>
  <action name="RemoveProduct"/>
  <module name="modules.pages.cart.MCart_Row_clickRemoveProduct">
    <parameter name="row" value="1"/>
  </module>
  <module name="modules.pages.cart.VCart_validateEmptyProductList"/>
  <codecomment># Teardown

- End session</codecomment>
</testcase>